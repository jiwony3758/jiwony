---
title: "next.js SEO 적용 - 사이트맵과 robots"
description: "next.js에서 사이트맵과 robots.txt를 만들어 SEO 적용해보기"
category: "develop"
date: "2023-10-12"
tags: "next.js,SEO,sitemap,robots.txt"
---



## 사이트맵(sitemap)
&nbsp;
사이트맵은 사이트에 있는 페이지, 동영상 및 기타 파일과 그 관계에 관한 정보를 제공하는 파일이다.
검색엔진은 사이트맵을 읽고 사이트를 효율적으로 크롤링한다.

&nbsp;
구글에 사이트맵을 제출하는 방법은 두 가지가 있다.
1. 구글의 [Search Console API를 사용해서 제출하는 방법](https://developers.google.com/webmaster-tools/v1/sitemaps/submit?hl=ko)
2. Googlebot이 ping을 사용해 사이트맵 파일에 액세스 하는 방법

&nbsp;
난 여기서 구글봇이 ping으로 액세스할 수 있게 만들 예정이다.
구글이 핑을 보내는 방법은 [여기](https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap?hl=ko)서 확인하면 된다.

### 사이트맵 만들기
1. #### /app/sitemap/route.ts 경로에 api를 만든다
```js title="/app/sitemap/route.ts"
export function GET() {
  const date = new Date();
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0");
  const day = String(date.getDate()).padStart(2, "0");
  
  const allPostPaths = getAllPostPathStrings();

  const postsSitemap = allPostPaths.map((pathname) => {
    return `
      <url>
        <loc>${url}/blog/posts/${pathname}</loc>
        <lastmod>${year}-${month}-${day}</lastmod>
      </url>
    `;
  }).toString().replaceAll(",", "");
  const sitemap = `
      <?xml version="1.0" encoding="UTF-8"?>
        <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
            ${postsSitemap}
        </urlset>
    `.trim();

  return new Response(sitemap, {
    status: 200,
    headers: { 'Content-Type': 'application/xml' }
  })
}
```
- 2~5번 줄은 W3C Datetime 포맷을 위한 날짜 정의
- 7번 줄은 sitemap에 등록할 게시물을 불러오는 함수 호출
- 9~16번 줄은 각 게시물마다 사이트맵 url을 생성해준다.
  - `<lastmod></lastmod>`는 수정일
  - `<loc></loc>`은 사이트맵의 위치
  - 16번 줄은 문자열로 변환해주고 리스트를 문자열로 그대로 변환할 시 콤마가 생기므로 없애준다.
- 17~22번 줄은 완성된 사이트맵 폼으로 만들어준다.
- 24~27번 줄은 xml형태로 response를 주는 응답 구문이다.

2. #### /next.config.js에서 rewrites를 추가해준다.

```js title="/next.config.js"
const nextConfig = {
  async rewrites() {
    return [
      {
        source: "/sitemap.xml",
        destination: "/api/sitemap"
      }
    ]
  },
};
```
- rewrites는 destination 경로의 URL 프록시 역할을 해준다.
- 구글에서 https://jiwony.dev/sitemap.xml로 요청하면 위에서 만든 api로 호출하게 되는 것이다.

## robots.txt
&nbsp;
robots.txt란 웹사이트에 웹 크롤러같은 로봇들의 접근을 제어하기 위한 규약이다. 

### robots.txt 만들기

1. #### /app/robots/route.ts 경로에 api를 만든다
```js title="/app/robots/route.ts"
export function GET() {
  return new Response(`User-agent: *
Allow: /
Disallow: /api
Sitemap: ${siteUrl}/sitemap.xml
Host: ${siteUrl}
  `, {
    status: 200,
  });
}
```
- User-agent: 제어할 로봇의 User-Agent
  - ex) 구글: Googlebot, Naver: Yeti
- Allow: 접근 허가할 경로이며 맨 끝에 /를 붙이지 않으면 확장자가 없는 파일로 인식해서 제대로 작동하지 않는다.
  - ex) /blog/posts/ 
- Disallow: 접근 차단 경로
- Sitemap: 사이트맵 경로로 위에서 만든 사이트맵 경로를 기입하면 된다.

2. ### /next.config.js에서 rewrites를 추가해준다.
```js title="/next.config.js"
async rewrites() {
    return [
      {
        source: "/sitemap.xml",
        destination: "/api/sitemap"
      },
      {
        source: "/robots.txt",
        destination: "/api/robots"
      }
    ]
  },
```
- sitemap을 만든 것과 같은 방식으로 rewrites안에 추가해준다.

## 마무리
sitemap과 robots.txt로 SEO를 진행해봤다. 
사실 사이트맵이랑 robots.txt를 만들어주는 라이브러리도 있지만 직접 api를 만들고 next.config.js를 수정하면서 만든 이유는
next.js의 기능을 적극적으로 사용하고자 하는 마음이 컸기 때문이다.
직접 구현하면서 프레임워크에 더 익숙해지는 과정이 좋다고나 할까.

&nbsp;
그리고 다음에는 SEO관련해서 `<head></head>`의 meta 태그와 path 및 내용 관련해서 적용하고 글을 업로드 할 예정이다.



** 참조 **
- [사이트맵이란 무엇인가요? | Google 검색 센터 |  문서 | Google for Developers](https://developers.google.com/search/docs/crawling-indexing/sitemaps/overview?hl=ko)
- [사이트맵 제작 및 제출하기 | Google 검색 센터 | 문서 | Google for Developers](https://developers.google.com/search/docs/crawling-indexing/sitemaps/build-sitemap?hl=ko)
- [robots.txt 소개 및 가이드 | Google 검색 센터 | 문서 | Google for Developers](https://developers.google.com/search/docs/crawling-indexing/robots/intro?hl=ko)
- [robots.txt 파일 만들기 및 제출 | Google 검색 센터 | 문서 | Google for Developers](https://developers.google.com/search/docs/crawling-indexing/robots/create-robots-txt?hl=ko)
- [robots.txt - 나무위키](https://namu.wiki/w/robots.txt)
- [Date and Time Formats](https://www.w3.org/TR/NOTE-datetime)
